# 摄像头曝光调整说明

## 问题描述

摄像头过曝会导致：
- 人脸检测准确率下降
- 面部特征不清晰
- 影响疲劳检测效果
- 图像过亮，细节丢失

## 解决方案

我已经为您添加了完整的摄像头曝光控制功能，包括：

### 1. 自动曝光控制
在main.py中添加了`setup_camera_exposure_control`方法，会在摄像头初始化时自动应用优化设置。

### 2. 交互式调整工具
提供了独立的`camera_exposure_tool.py`工具，可以实时调整曝光参数。

## 使用方法

### 方法一：自动优化（推荐）

直接运行主程序，系统会自动应用优化的曝光设置：

```bash
python main.py
```

**自动应用的设置：**
- 曝光值: -6 (减少过曝)
- 亮度: 0.4 (中等偏暗)
- 对比度: 0.6 (中等偏高)
- 增益: 0.3 (较低增益)
- 禁用自动曝光和自动白平衡

### 方法二：手动调整工具

如果自动设置效果不理想，可以使用交互式工具进行精细调整：

```bash
python camera_exposure_tool.py
```

**键盘控制：**
- `Q/A` - 增加/减少曝光
- `W/S` - 增加/减少亮度  
- `E/D` - 增加/减少对比度
- `R` - 重置到推荐设置
- `ESC` - 退出工具

### 方法三：指定摄像头索引

如果有多个摄像头，可以指定索引：

```bash
python camera_exposure_tool.py 1  # 使用摄像头索引1
```

## 参数说明

### 曝光值 (Exposure)
- **范围**: -13 到 -1
- **推荐**: -6 (中等偏暗)
- **说明**: 负值越大，图像越暗，可以减少过曝

### 亮度 (Brightness)
- **范围**: 0.0 到 1.0
- **推荐**: 0.4 (中等偏暗)
- **说明**: 调整整体亮度，配合曝光使用

### 对比度 (Contrast)
- **范围**: 0.0 到 1.0
- **推荐**: 0.6 (中等偏高)
- **说明**: 提高对比度可以增强面部特征

### 增益 (Gain)
- **范围**: 0.0 到 1.0
- **推荐**: 0.3 (较低增益)
- **说明**: 低增益减少噪点，提高图像质量

## 调整建议

### 针对不同环境

#### 强光环境（过曝严重）
```python
曝光: -8 到 -10
亮度: 0.2 到 0.3
对比度: 0.7 到 0.8
增益: 0.1 到 0.2
```

#### 正常光线环境
```python
曝光: -5 到 -7
亮度: 0.4 到 0.5
对比度: 0.5 到 0.6
增益: 0.3 到 0.4
```

#### 弱光环境
```python
曝光: -3 到 -5
亮度: 0.5 到 0.6
对比度: 0.4 到 0.5
增益: 0.4 到 0.6
```

### 调整步骤

1. **首先调整曝光值**
   - 如果图像过亮，减少曝光值（更负）
   - 如果图像过暗，增加曝光值（更正）

2. **然后调整亮度**
   - 配合曝光值进行微调
   - 确保人脸区域清晰可见

3. **最后调整对比度**
   - 增强面部特征的清晰度
   - 提高检测准确率

## 故障排除

### 问题1：设置不生效
```
某些摄像头可能不支持手动曝光控制
```
**解决方案：**
- 尝试不同的摄像头
- 更新摄像头驱动程序
- 使用USB摄像头替代内置摄像头

### 问题2：图像仍然过曝
```
自动设置可能不适合您的环境
```
**解决方案：**
- 使用交互式工具手动调整
- 尝试更低的曝光值（-8到-10）
- 调整环境光线

### 问题3：图像太暗
```
曝光值设置过低
```
**解决方案：**
- 增加曝光值（-4到-6）
- 适当提高亮度（0.5-0.6）
- 检查环境光线是否充足

### 问题4：人脸检测效果差
```
图像质量影响检测准确率
```
**解决方案：**
- 确保人脸区域光线均匀
- 避免强烈的背光
- 调整对比度提高特征清晰度

## 高级功能

### 实时调整（开发中）
未来版本将支持在主程序运行时实时调整曝光参数。

### 自动适应（开发中）
根据环境光线自动调整曝光参数。

### 配置文件保存（开发中）
保存优化的参数设置，下次启动时自动应用。

## 技术细节

### 支持的摄像头属性
- `CAP_PROP_AUTO_EXPOSURE` - 自动曝光控制
- `CAP_PROP_EXPOSURE` - 手动曝光值
- `CAP_PROP_BRIGHTNESS` - 亮度
- `CAP_PROP_CONTRAST` - 对比度
- `CAP_PROP_GAIN` - 增益
- `CAP_PROP_AUTO_WB` - 自动白平衡
- `CAP_PROP_WB_TEMPERATURE` - 色温

### 兼容性
- **Windows**: 支持DirectShow后端
- **Linux**: 支持V4L2后端
- **macOS**: 支持AVFoundation后端

## 总结

通过合理的曝光控制，可以显著改善：
- ✅ 减少图像过曝
- ✅ 提高人脸检测准确率
- ✅ 增强面部特征清晰度
- ✅ 改善疲劳检测效果

建议先使用自动设置，如果效果不理想再使用交互式工具进行精细调整。
