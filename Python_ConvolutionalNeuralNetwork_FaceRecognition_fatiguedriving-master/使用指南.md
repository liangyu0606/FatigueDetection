# ç–²åŠ³æ£€æµ‹ç³»ç»Ÿ - å…¬å¼€æ•°æ®é›†è®­ç»ƒæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£…åŸºç¡€ä¾èµ–
pip install opencv-python numpy scikit-learn

# å®‰è£…æ·±åº¦å­¦ä¹ ä¾èµ–ï¼ˆç”¨äºCNNåŠŸèƒ½ï¼‰
pip install tensorflow
```

### 2. ä¸‹è½½å…¬å¼€æ•°æ®é›†

æ¨èä½¿ç”¨ä»¥ä¸‹æ•°æ®é›†ï¼š

#### ğŸ¥‡ Drowsiness Detection Dataset (æ¨è)
- **æ¥æº**: Kaggle
- **é“¾æ¥**: https://www.kaggle.com/datasets/dheerajperumandla/drowsiness-dataset
- **åŒ…å«**: æ¸…é†’ã€ç–²åŠ³ã€æ‰“å“ˆæ¬ ã€é—­çœ¼çŠ¶æ€
- **æ ·æœ¬æ•°**: ~2900å¼ å›¾åƒ

#### ğŸ¥ˆ Driver Drowsiness Dataset
- **æ¥æº**: Kaggle  
- **é“¾æ¥**: https://www.kaggle.com/datasets/ismailnasri20/driver-drowsiness-dataset
- **åŒ…å«**: æ¸…é†’ã€ç–²åŠ³çŠ¶æ€
- **æ ·æœ¬æ•°**: ~1000å¼ å›¾åƒ

#### ğŸ¥‰ MRL Eye Dataset
- **æ¥æº**: Kaggle
- **é“¾æ¥**: https://www.kaggle.com/datasets/kutaykutlu/drowsiness-detection
- **åŒ…å«**: ççœ¼ã€é—­çœ¼çŠ¶æ€
- **æ ·æœ¬æ•°**: ~4000å¼ å›¾åƒ

### 3. æ•°æ®é›†å‡†å¤‡

1. ä»Kaggleä¸‹è½½æ•°æ®é›†
2. è§£å‹åˆ° `./public_datasets/raw/` ç›®å½•
3. è¿è¡Œè®­ç»ƒè„šæœ¬

```bash
# åˆ›å»ºç›®å½•ç»“æ„
mkdir -p public_datasets/raw

# å°†ä¸‹è½½çš„æ•°æ®é›†è§£å‹åˆ° public_datasets/raw/ ç›®å½•
```

### 4. å¼€å§‹è®­ç»ƒ

```bash
# è¿è¡Œè®­ç»ƒè„šæœ¬
python public_dataset_trainer.py
```

## ğŸ“ ç›®å½•ç»“æ„

è®­ç»ƒå®Œæˆåçš„ç›®å½•ç»“æ„ï¼š

```
project/
â”œâ”€â”€ public_datasets/
â”‚   â”œâ”€â”€ raw/                    # åŸå§‹æ•°æ®é›†
â”‚   â”œâ”€â”€ drowsiness_detection/
â”‚   â”‚   â”œâ”€â”€ processed/          # å¤„ç†åçš„æ•°æ®
â”‚   â”‚   â”œâ”€â”€ train/              # è®­ç»ƒé›†
â”‚   â”‚   â”œâ”€â”€ validation/         # éªŒè¯é›†
â”‚   â”‚   â””â”€â”€ test/               # æµ‹è¯•é›†
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ fatigue_model_mobilenet.h5  # è®­ç»ƒå¥½çš„æ¨¡å‹
â”‚   â””â”€â”€ class_indices.json          # ç±»åˆ«æ˜ å°„
â”œâ”€â”€ public_dataset_trainer.py       # è®­ç»ƒè„šæœ¬
â””â”€â”€ simple_cnn_detector.py         # ç®€åŒ–çš„æ£€æµ‹å™¨
```

## ğŸ”§ é›†æˆåˆ°ä¸»ç¨‹åº

è®­ç»ƒå®Œæˆåï¼Œåœ¨æ‚¨çš„ `main.py` ä¸­é›†æˆCNNæ£€æµ‹å™¨ï¼š

```python
# åœ¨main.pyé¡¶éƒ¨æ·»åŠ å¯¼å…¥
from simple_cnn_detector import CNNFatigueDetector

# åœ¨MainUIç±»çš„__init__æ–¹æ³•ä¸­åˆå§‹åŒ–
def __init__(self):
    # ... ç°æœ‰ä»£ç  ...
    
    # åˆå§‹åŒ–CNNæ£€æµ‹å™¨
    self.cnn_detector = CNNFatigueDetector('./model/fatigue_model_mobilenet.h5')
    
    # ... ç°æœ‰ä»£ç  ...

# åœ¨æ£€æµ‹å¾ªç¯ä¸­ä½¿ç”¨CNNæ£€æµ‹å™¨
def _learning_face(self):
    # ... ç°æœ‰ä»£ç  ...
    
    # åœ¨äººè„¸æ£€æµ‹æˆåŠŸåæ·»åŠ CNNåˆ†æ
    if len(faces) != 0:
        for k, d in enumerate(faces):
            # ... ç°æœ‰çš„äººè„¸æ£€æµ‹ä»£ç  ...
            
            # æå–äººè„¸åŒºåŸŸ
            face_img = im_rd[d.top():d.bottom(), d.left():d.right()]
            
            # ä½¿ç”¨CNNè¿›è¡Œç–²åŠ³æ£€æµ‹
            if self.cnn_detector.is_available():
                cnn_result = self.cnn_detector.get_fatigue_analysis(face_img)
                if cnn_result:
                    # å°†CNNç»“æœä¸ä¼ ç»Ÿæ–¹æ³•ç»“åˆ
                    if cnn_result['fatigue_detected']:
                        res[1] = cnn_result['fatigue_level']
                        print(f"CNNæ£€æµ‹: {cnn_result['fatigue_level']} (ç½®ä¿¡åº¦: {cnn_result['confidence']:.2f})")
            
            # ... ç»§ç»­ç°æœ‰ä»£ç  ...
```

## ğŸ“Š è®­ç»ƒå‚æ•°è¯´æ˜

### æ¨¡å‹é€‰æ‹©
- **MobileNetV2**: è½»é‡çº§ï¼Œé€‚åˆå®æ—¶æ£€æµ‹
- **ResNet50**: é«˜ç²¾åº¦ï¼Œè®¡ç®—é‡è¾ƒå¤§
- **VGG16**: ç»å…¸ç½‘ç»œï¼Œç¨³å®šå¯é 

### è®­ç»ƒå‚æ•°
- **epochs**: 30 (å¯æ ¹æ®æ•°æ®é›†å¤§å°è°ƒæ•´)
- **batch_size**: 32
- **å­¦ä¹ ç‡**: 0.001
- **æ•°æ®å¢å¼º**: æ—‹è½¬ã€å¹³ç§»ã€äº®åº¦è°ƒæ•´

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®è´¨é‡
- ç¡®ä¿æ•°æ®é›†æ ‡æ³¨å‡†ç¡®
- å¹³è¡¡å„ç±»åˆ«æ ·æœ¬æ•°é‡
- åŒ…å«ä¸åŒå…‰ç…§æ¡ä»¶çš„å›¾åƒ

### 2. æ¨¡å‹è°ƒä¼˜
- æ ¹æ®å®é™…ä½¿ç”¨åœºæ™¯è°ƒæ•´é˜ˆå€¼
- ä½¿ç”¨äº¤å‰éªŒè¯è¯„ä¼°æ¨¡å‹æ€§èƒ½
- è€ƒè™‘æ¨¡å‹é›†æˆæé«˜å‡†ç¡®ç‡

### 3. å®æ—¶æ€§ä¼˜åŒ–
- ä½¿ç”¨MobileNetç­‰è½»é‡çº§æ¨¡å‹
- é™ä½è¾“å…¥å›¾åƒåˆ†è¾¨ç‡
- ä½¿ç”¨GPUåŠ é€Ÿæ¨ç†

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **TensorFlowå®‰è£…å¤±è´¥**
   ```bash
   # ä½¿ç”¨condaå®‰è£…
   conda install tensorflow
   
   # æˆ–æŒ‡å®šç‰ˆæœ¬
   pip install tensorflow==2.10.0
   ```

2. **å†…å­˜ä¸è¶³**
   - å‡å°batch_size
   - ä½¿ç”¨æ›´å°çš„æ¨¡å‹
   - å‡å°‘æ•°æ®å¢å¼º

3. **è®­ç»ƒé€Ÿåº¦æ…¢**
   - ä½¿ç”¨GPUè®­ç»ƒ
   - å‡å°‘epochsæ•°é‡
   - ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹

4. **æ¨¡å‹ç²¾åº¦ä½**
   - å¢åŠ è®­ç»ƒæ•°æ®
   - è°ƒæ•´å­¦ä¹ ç‡
   - ä½¿ç”¨æ›´å¤æ‚çš„æ¨¡å‹

## ğŸ“ˆ è¯„ä¼°æŒ‡æ ‡

è®­ç»ƒå®Œæˆåï¼Œç³»ç»Ÿä¼šè¾“å‡ºä»¥ä¸‹æŒ‡æ ‡ï¼š

- **å‡†ç¡®ç‡ (Accuracy)**: æ•´ä½“é¢„æµ‹æ­£ç¡®ç‡
- **æŸå¤±å€¼ (Loss)**: æ¨¡å‹è®­ç»ƒæŸå¤±
- **éªŒè¯å‡†ç¡®ç‡**: éªŒè¯é›†ä¸Šçš„æ€§èƒ½

## ğŸ‰ å®Œæˆåçš„æ•ˆæœ

æˆåŠŸè®­ç»ƒåï¼Œæ‚¨çš„ç–²åŠ³æ£€æµ‹ç³»ç»Ÿå°†å…·å¤‡ï¼š

1. **ä¼ ç»Ÿæ–¹æ³•**: çœ¨çœ¼ã€æ‰“å“ˆæ¬ ã€ç‚¹å¤´æ£€æµ‹
2. **CNNæ–¹æ³•**: æ·±åº¦å­¦ä¹ ç–²åŠ³çŠ¶æ€è¯†åˆ«
3. **èåˆæ£€æµ‹**: ä¸¤ç§æ–¹æ³•ç»“åˆï¼Œæé«˜å‡†ç¡®ç‡
4. **å®æ—¶åˆ†æ**: æµç•…çš„å®æ—¶ç–²åŠ³æ£€æµ‹

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. æ•°æ®é›†æ˜¯å¦æ­£ç¡®ä¸‹è½½å’Œè§£å‹
2. ä¾èµ–åº“æ˜¯å¦æ­£ç¡®å®‰è£…
3. ç›®å½•ç»“æ„æ˜¯å¦æ­£ç¡®
4. æ¨¡å‹æ–‡ä»¶æ˜¯å¦æˆåŠŸç”Ÿæˆ

ç¥æ‚¨è®­ç»ƒæˆåŠŸï¼ğŸŠ
