# 混合疲劳检测系统GUI使用说明

## 🎯 系统概述

这是一个基于CNN+LSTM混合模型的智能疲劳检测系统，提供友好的图形用户界面，支持实时疲劳状态监测。

## 🚀 快速开始

### 1. 启动系统
```bash
python real_pljc/启动GUI检测.py
```
或者直接运行：
```bash
python real_pljc/hybrid_gui_detection.py
```

### 2. 加载模型
在启动GUI后，需要按顺序加载以下组件：

1. **加载混合模型** - 点击"加载混合模型"按钮，选择 `models/best_hybrid_fatigue_model.pth`
2. **加载dlib预测器** - 点击"加载dlib预测器"按钮，选择 `shape_predictor_68_face_landmarks.dat`
3. **加载标准化器** - 点击"加载标准化器"按钮，选择 `models/hybrid_scaler.pkl`

### 3. 开始检测
- 确保所有模型加载完成后，点击"开始检测"按钮
- 系统将自动启动摄像头并开始实时检测

## 🎛️ 界面功能

### 控制面板（左侧）

#### 模型设置
- **加载混合模型**: 加载训练好的CNN+LSTM混合模型
- **加载dlib预测器**: 加载面部关键点检测器
- **加载标准化器**: 加载特征标准化器
- **模型状态指示**: 显示模型加载状态

#### 检测参数
- **疲劳阈值**: 调整疲劳检测的敏感度（0.5-0.9）
  - 数值越高，检测越严格，误报越少
  - 数值越低，检测越敏感，可能增加误报
- **连续检测帧数**: 需要连续多少帧检测到疲劳才确认（5-20帧）
  - 数值越高，越能避免偶然误报
  - 数值越低，响应越快

#### 控制按钮
- **开始检测**: 启动实时疲劳检测
- **停止检测**: 停止检测并关闭摄像头
- **标记误报**: 如果系统误报，可点击此按钮标记
- **重置统计**: 清零所有统计数据

#### 统计信息
实时显示：
- 检测统计（总次数、误报次数、准确率）
- 检测时长
- 当前参数设置
- 模型加载状态

#### 显示设置
- **显示调试信息**: 在视频上显示详细的检测参数
- **显示人脸框**: 在检测到的人脸周围显示边框
- **显示关键点**: 显示68个面部关键点

### 视频显示区域（右侧）

#### 实时视频
- 显示摄像头捕获的实时视频
- 叠加显示检测状态和相关信息
- 根据检测结果改变人脸框颜色：
  - 🟢 绿色：正常状态
  - 🟡 黄色：说话中
  - 🔵 蓝色：冷却期
  - 🔴 红色：检测到疲劳

#### 检测信息
- 显示当前检测状态和概率
- 实时数据：EAR、MAR变化、说话状态等

### 状态栏（底部）
- **状态信息**: 显示系统当前状态
- **FPS**: 显示视频处理帧率
- **设备信息**: 显示计算设备（CPU/GPU）

## 🔧 参数调优指南

### 减少误报（说话被识别为疲劳）
1. **提高疲劳阈值**: 将阈值从0.75调整到0.8或0.85
2. **增加连续帧数**: 将连续检测帧数从10增加到15或20
3. **观察MAR变化**: 系统会自动检测说话状态并调整阈值

### 提高检测敏感度
1. **降低疲劳阈值**: 将阈值调整到0.6或0.65
2. **减少连续帧数**: 将连续检测帧数调整到5-8帧
3. **注意**: 可能会增加误报率

### 最佳实践
1. **初始设置**: 使用默认参数（阈值0.75，连续帧数10）
2. **观察一段时间**: 记录误报和漏报情况
3. **逐步调整**: 根据实际使用情况微调参数
4. **标记误报**: 及时标记误报以评估系统准确性

## 🎨 界面元素说明

### 状态颜色含义
- **🔴 红色**: 疲劳警告
- **🟡 黄色**: 说话中
- **🔵 蓝色**: 冷却期
- **🟢 绿色**: 正常状态

### 音频提示
- 检测到疲劳时会发出系统提示音
- 可根据需要添加更多警告方式

## 🛠️ 故障排除

### 常见问题

#### 1. 摄像头无法打开
- 检查摄像头是否被其他程序占用
- 确认摄像头驱动正常
- 尝试重启应用程序

#### 2. 模型加载失败
- 确认模型文件路径正确
- 检查模型文件是否完整
- 确认PyTorch版本兼容性

#### 3. 检测效果不佳
- 确保光照充足
- 保持人脸正对摄像头
- 调整检测参数
- 检查是否加载了标准化器

#### 4. 界面卡顿
- 检查CPU/GPU使用率
- 降低视频分辨率
- 关闭不必要的调试信息显示

### 性能优化
1. **使用GPU**: 确保安装了CUDA版本的PyTorch
2. **调整参数**: 适当降低序列长度或图像尺寸
3. **关闭调试**: 在正式使用时关闭调试信息显示

## 📊 数据说明

### 检测指标
- **EAR (Eye Aspect Ratio)**: 眼部纵横比，用于检测眨眼
- **MAR (Mouth Aspect Ratio)**: 嘴部纵横比，用于检测打哈欠
- **MAR变化**: 用于区分说话和打哈欠

### 统计数据
- **总检测次数**: 系统确认的疲劳检测总数
- **误报次数**: 用户标记的误报数量
- **准确率**: (总检测次数 - 误报次数) / 总检测次数

## 🔄 更新日志

### v1.0 特性
- ✅ 混合CNN+LSTM模型支持
- ✅ 实时疲劳检测
- ✅ 智能说话检测
- ✅ 可调参数界面
- ✅ 统计信息显示
- ✅ 误报标记功能

### 未来计划
- 🔄 多人脸检测支持
- 🔄 检测历史记录
- 🔄 自定义警告方式
- 🔄 模型性能分析

## 📞 技术支持

如有问题或建议，请：
1. 检查本使用说明
2. 查看控制台错误信息
3. 提交Issue或联系开发团队

---

**注意**: 本系统仅供研究和学习使用，不应作为安全关键应用的唯一依据。
